<!DOCTYPE html>
<html lang="en" xml:lang="en" xmlns= "http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta name="google" content="notranslate" />
    <meta http-equiv="Content-Language" content="en" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="x-dns-prefetch-control" content="on" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta name="keywords" content="chain,'chain id', 'get chain id', protocol, network, 'get network', metamask, 'meta mask',eth,polygon,matic,crypto,token,blockchain,'block chain',web3" />
    <meta name="description" content="Scrollable chainapi object viewer" />
    <meta name="website" content="fetch_chain.html" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>chain_fetch.html: Fetch any chain network's info from chainid.network API</title>
  </head>
  <body>
    <div style="margin:1%;font-size:0.9em;font-family: Georgia, Times, 'Times New Roman', serif;">
      <div>
        <h3>chain_fetch.html:</h3>
        <p>fetch(<a href="https://chainid.network/chains.json">https://chainid.network/chains.json</a>) chain network's info from chainid.network API</p>
        <div style="margin:4%">
          <select id="select-chain" onchange="selectedChain();"></select>
            <div id="selected-chain" style="margin:4%"></div>
        </div>
      </div>
      <span>
        <a href="MIT-license.md">Released under the MIT License</a>
        <p>Copyright (c) 2022 <a href="mailto:forthepeoplebythepeople@protonmail.com">forthepeoplebythepeople@protonmail.com</a></p>
      </span>
    </div>


    <script type="text/javascript">
      // Assign/declare fetched chain data variable as a global array
      const d = [];

      // Add options to DOM select input
      // o = object
      // id = select element's id
      function addOptions(o,id) {
        let e = document.getElementById(`${id}`);
        Object.entries(o).forEach(([key, value]) => {
            let opt = new Option(key, value);
            e.add(opt); 
        });
      }

      // fetch chain API
      fetch('https://chainid.network/chains.json')
        .then((res) => res.json())
        .then((data) => {
          Object.values(data).forEach((value) => {
            Object.entries(value).forEach(([k,v]) => {
              if (k === 'name') {
                let temp = {};
                temp[`${v}`] = value;
                addOptions(temp,'select-chain'); 
                d.push(value);
              }
            })
          })
          // onLoad-> select 1st record as default (ethereum)
          selectedChain();
        })
        .catch(e => console.error(e));
      
      // event handler -> display selected chain params
      function selectedChain(i) {
        let o = document.getElementById('select-chain');
        let s = document.getElementById('selected-chain');
        let t = o[o.selectedIndex].text;
        if (!i) i = o.selectedIndex;

        console.log(`d[${i}]: `,d[i]);
        if (s.textContent) s.innerHTML ='';
        Object.entries(d[i]).forEach(([k,v]) => {
          if (typeof v ==='object' || typeof v ==='array') {
            Object.entries(v).forEach(([k2,v2]) => {
              if (typeof v2 ==='object' || typeof v2 ==='array') {
                Object.entries(v2).forEach(([k3,v3]) => {
                  s.innerHTML += `<p>[${k}] [${k2}] ${k3}: ${v3}</p>`
                })
              } else s.innerHTML += `<p>[${k}] ${k2}: ${v2}</p>`
            });
          } else s.innerHTML += `<p>${k}: ${v}</p>`;
        });
      }
    </script>

  </body>
</html>